<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="GISUGO - A marketplace for searching and posting jobs in your local neighborhood">
    <meta name="keywords" content="local service, gig economy, marketplace, jobs, services">
    <title>GISUGO - Local Service Marketplace</title>
    <link rel="stylesheet" href="public/css/home.css?v=5.1">
    <!-- Add favicon -->
    <link rel="icon" type="image/png" href="public/images/favicon.png">
    <style>
      /* Loading Animation for Menu */
      .menu-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
      }
      
      .menu-loading-spinner {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-right: 10px;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Logout Confirmation Modal */
      .logout-confirm-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 99998;
        pointer-events: none;
      }
      
      .logout-confirm-overlay.active {
        display: flex;
        pointer-events: auto;
      }
      
      .logout-confirm-modal {
        background: #fff;
        border-radius: 12px;
        padding: 30px;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        text-align: center;
      }
      
      .logout-confirm-emoji {
        font-size: 48px;
        margin-bottom: 15px;
      }
      
      .logout-confirm-title {
        font-size: 22px;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
      }
      
      .logout-confirm-message {
        font-size: 16px;
        color: #666;
        margin-bottom: 25px;
        line-height: 1.5;
      }
      
      .logout-confirm-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
      }
      
      .logout-confirm-btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .logout-confirm-btn.cancel {
        background: #e0e0e0;
        color: #333;
      }
      
      .logout-confirm-btn.cancel:hover {
        background: #d0d0d0;
      }
      
      .logout-confirm-btn.confirm {
        background: #ff4444;
        color: #fff;
      }
      
      .logout-confirm-btn.confirm:hover {
        background: #ff2222;
      }
      
      /* Logout Loading Overlay */
      .logout-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 99999;
        flex-direction: column;
        backdrop-filter: blur(8px);
        pointer-events: none;
      }
      
      .logout-overlay.active {
        display: flex;
        pointer-events: auto;
      }
      
      .logout-emoji {
        font-size: 72px;
        margin-bottom: 25px;
        animation: wave 1.5s ease-in-out infinite;
      }
      
      @keyframes wave {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(20deg); }
        75% { transform: rotate(-20deg); }
      }
      
      .logout-spinner {
        width: 60px;
        height: 60px;
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      
      .logout-message {
        color: #fff;
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 10px;
      }
      
      .logout-message span {
        display: inline-block;
        opacity: 0;
        animation: emphasizeWord 0.5s ease-out forwards;
      }
      
      .logout-message span:nth-child(1) { animation-delay: 0s; }
      .logout-message span:nth-child(2) { animation-delay: 0.2s; }
      .logout-message span:nth-child(3) { animation-delay: 0.4s; }
      .logout-message span:nth-child(4) { animation-delay: 0.6s; }
      
      @keyframes emphasizeWord {
        0% {
          opacity: 0;
          transform: translateY(10px) scale(0.8);
        }
        50% {
          transform: translateY(-5px) scale(1.1);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      .logout-submessage {
        color: rgba(255, 255, 255, 0.9);
        font-size: 16px;
        font-weight: 400;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header-wrapper">
      <header class="header">
        <div class="header__logo-wrapper">
        <img src="public/images/Gisugo-emblem.png" alt="GISUGO Logo - Person with shopping bag" class="header__logo">
        </div>
        <div class="header__title-group">
          <h1 class="header__title">GISUGO</h1>
          <p class="header__subtitle">Local Service Marketplace</p>
        </div>
        <button class="header__menu" aria-label="Menu">
          <span class="header__menu-emoji">üìã</span>
          <span class="header__menu-caption">Menu</span>
        </button>
        
        <!-- Backdrop: closes menu when tapping outside (needed for iOS Safari) -->
        <div class="menu-backdrop" id="menuBackdrop" onclick="closeHomeMenu()"></div>

        <!-- Menu Overlay -->
        <nav class="menu-overlay" id="homeMenuOverlay">
          <div class="home-menu-grid" id="homeMenuList">
            <!-- Loading state (shown initially until Firebase confirms auth state) -->
            <div class="menu-loading">
              <div class="menu-loading-spinner"></div>
              <span>Loading...</span>
            </div>
          </div>
        </nav>
      </header>
      <div class="accent-line1"></div>
    </div>

    <div class="header-spacer"></div>

    <!-- Logout Confirmation Modal -->
    <div class="logout-confirm-overlay" id="logoutConfirmOverlay">
      <div class="logout-confirm-modal">
        <div class="logout-confirm-emoji">‚ö†Ô∏è</div>
        <div class="logout-confirm-title">Are you sure?</div>
        <div class="logout-confirm-message">We'll miss you!</div>
        <div class="logout-confirm-buttons">
          <button class="logout-confirm-btn cancel" onclick="cancelLogout()">Stay</button>
          <button class="logout-confirm-btn confirm" onclick="confirmLogout()">Log Out</button>
        </div>
      </div>
    </div>

    <!-- Logout Loading Overlay -->
    <div class="logout-overlay" id="logoutOverlay">
      <div class="logout-emoji">üëã</div>
      <div class="logout-spinner"></div>
      <div class="logout-message">
        <span>Come</span> <span>back</span> <span>again</span> <span>soon!</span>
      </div>
      <div class="logout-submessage">Logging out...</div>
    </div>

    <!-- Video Section with Custom Thumbnail -->
    <section class="video-container">
      <div class="video-wrapper">
        <!-- Custom Thumbnail Overlay -->
        <div class="video-thumbnail-overlay" onclick="playVideo()">
          <img src="public/images/GISUGO-BANNER-horizontal.jpg" alt="Play GISUGO Video" class="custom-thumbnail">
          <div class="play-button">‚ñ∂</div>
        </div>
        
        <!-- YouTube iframe (loaded on click) -->
        <iframe 
          id="youtube-player"
          width="560" 
          height="315" 
          src=""
          title="How to use GISUGO" 
          frameborder="0" 
          style="display: none;"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen>
        </iframe>
      </div>
    </section>

    <!-- Accent Line -->
    <div class="accent-line2"></div>

    <!-- Basic Helper Section -->
    <section>
      <h2 class="category-header tier-basic">BASIC HELPER</h2>
      <div class="service-grid">
        <a href="limpyo.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Limpyo.png" alt="Cleaning Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">LIMPYO</h3>
        </a>
        <a href="hakot.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Hakot.png" alt="Moving Help" class="service-card__image">
          </div>
          <h3 class="service-card__title">HAKOT</h3>
        </a>
        <a href="hatod.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Hatod.png" alt="Delivery Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">HATOD</h3>
        </a>
        <a href="hugas.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Hugas.png" alt="Dishwashing Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">HUGAS</h3>
        </a>
        <a href="luto.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Luto.png" alt="Cooking Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">LUTO</h3>
        </a>
        <a href="laba.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Laba.png" alt="Laundry Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">LABA</h3>
        </a>
        <a href="kompra.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Kompra.png" alt="Shopping Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">KOMPRA</h3>
        </a>
        <a href="tindera.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Tindera.png" alt="Vendor Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">TINDERA</h3>
        </a>
        <a href="bantay.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Bantay.png" alt="Attending Service" class="service-card__image">
          </div>
          <h3 class="service-card__title">BANTAY</h3>
        </a>
        <a href="waiter.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Waiter.png?v=20260209" alt="Waiter" class="service-card__image">
          </div>
          <h3 class="service-card__title">WAITER</h3>
        </a>
        <a href="staff.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Staff.png" alt="Staff" class="service-card__image">
          </div>
          <h3 class="service-card__title">STAFF</h3>
        </a>
        <a href="reception.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/reception.png" alt="Reception" class="service-card__image">
          </div>
          <h3 class="service-card__title">RECEPTION</h3>
        </a>
      </div>
    </section>

    <!-- Skilled Worker Section -->
    <section>
      <h2 class="category-header tier-skilled">SKILLED WORKER</h2>
      <div class="service-grid">
        <a href="trainer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Trainer.png" alt="Trainer" class="service-card__image">
          </div>
          <h3 class="service-card__title">TRAINER</h3>
        </a>
        <a href="driver.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Driver.png" alt="Driver" class="service-card__image">
          </div>
          <h3 class="service-card__title">DRIVER</h3>
        </a>
        <a href="security.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Security.png" alt="Security" class="service-card__image">
          </div>
          <h3 class="service-card__title">SECURITY</h3>
        </a>
        <a href="barber.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Barber.png?v=20260209" alt="Barber" class="service-card__image">
          </div>
          <h3 class="service-card__title">BARBER</h3>
        </a>
        <a href="handyman.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Handyman.png?v=20260209" alt="Handyman" class="service-card__image">
          </div>
          <h3 class="service-card__title">HANDYMAN</h3>
        </a>
        <a href="builder.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/builder.png" alt="Builder" class="service-card__image">
          </div>
          <h3 class="service-card__title">BUILDER</h3>
        </a>
        <a href="painter.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Painter.png" alt="Painter" class="service-card__image">
          </div>
          <h3 class="service-card__title">PAINTER</h3>
        </a>
        <a href="gardner.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Gardner.png?v=20260209" alt="Gardner" class="service-card__image">
          </div>
          <h3 class="service-card__title">GARDNER</h3>
        </a>
        <a href="massage.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Massager.png?v=20260209" alt="Massager" class="service-card__image">
          </div>
          <h3 class="service-card__title">MASSAGER</h3>
        </a>
        <a href="petcare.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Pet Care.png" alt="Pet Care" class="service-card__image">
          </div>
          <h3 class="service-card__title">PET CARE</h3>
        </a>
        <a href="social.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Social.png" alt="Social" class="service-card__image">
          </div>
          <h3 class="service-card__title">SOCIAL</h3>
        </a>
        <a href="creative.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Creative.png" alt="Creative" class="service-card__image">
          </div>
          <h3 class="service-card__title">CREATIVE</h3>
        </a>
        <a href="artist.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Graphic-artist.png" alt="Artist" class="service-card__image">
          </div>
          <h3 class="service-card__title">ARTIST</h3>
        </a>
        <a href="musician.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Musician.png" alt="Musician" class="service-card__image">
          </div>
          <h3 class="service-card__title">MUSICIAN</h3>
        </a>
        <a href="performer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Performer.png?v=20260209" alt="Performer" class="service-card__image">
          </div>
          <h3 class="service-card__title">PERFORMER</h3>
        </a>
        <a href="photographer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Photographer.png" alt="Photographer" class="service-card__image">
          </div>
          <h3 class="service-card__title">PHOTOGRAPHER</h3>
        </a>
        <a href="videographer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Videographer.png" alt="Videographer" class="service-card__image">
          </div>
          <h3 class="service-card__title">VIDEOGRAPHER</h3>
        </a>
        <a href="editor.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Editor.png" alt="Editor" class="service-card__image">
          </div>
          <h3 class="service-card__title">EDITOR</h3>
        </a>
        <a href="secretary.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Secretary.png" alt="Secretary" class="service-card__image">
          </div>
          <h3 class="service-card__title">SECRETARY</h3>
        </a>
        <a href="tutor.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Tutor.png" alt="Tutor" class="service-card__image">
          </div>
          <h3 class="service-card__title">TUTOR</h3>
        </a>
        <a href="clerical.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/clerical.png" alt="Clerical" class="service-card__image">
          </div>
          <h3 class="service-card__title">CLERICAL</h3>
        </a>
      </div>
    </section>

    <!-- Professional Section -->
    <section>
      <h2 class="category-header tier-professional">PROFESSIONAL</h2>
      <div class="service-grid">
        <a href="nurse.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Nurse.png" alt="Nurse" class="service-card__image">
          </div>
          <h3 class="service-card__title">NURSE</h3>
        </a>
        <a href="doctor.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Doctor.png" alt="Doctor" class="service-card__image">
          </div>
          <h3 class="service-card__title">DOCTOR</h3>
        </a>
        <a href="lawyer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Lawyer.png" alt="Lawyer" class="service-card__image">
          </div>
          <h3 class="service-card__title">LAWYER</h3>
        </a>
        <a href="mechanic.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Mechanic.png" alt="Mechanic" class="service-card__image">
          </div>
          <h3 class="service-card__title">MECHANIC</h3>
        </a>
        <a href="electrician.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Electrician.png" alt="Electrician" class="service-card__image">
          </div>
          <h3 class="service-card__title">ELECTRICIAN</h3>
        </a>
        <a href="plumber.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Plumber.png" alt="Plumber" class="service-card__image">
          </div>
          <h3 class="service-card__title">PLUMBER</h3>
        </a>
        <a href="carpenter.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Carpenter.png" alt="Carpenter" class="service-card__image">
          </div>
          <h3 class="service-card__title">CARPENTER</h3>
        </a>
        <a href="researcher.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Researcher.png" alt="Researcher" class="service-card__image">
          </div>
          <h3 class="service-card__title">RESEARCHER</h3>
        </a>
        <a href="tailor.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Tailor.png" alt="Tailor" class="service-card__image">
          </div>
          <h3 class="service-card__title">TAILOR</h3>
        </a>
        <a href="chef.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Chef.png?v=20260209" alt="Chef" class="service-card__image">
          </div>
          <h3 class="service-card__title">CHEF</h3>
        </a>
        <a href="therapist.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Therapist.png" alt="Therapist" class="service-card__image">
          </div>
          <h3 class="service-card__title">THERAPIST</h3>
        </a>
        <a href="realtor.html" class="service-card">
          <div class="service-card__image-container service-card__emoji">
            <div class="service-card__emoji-icon">üè°</div>
          </div>
          <h3 class="service-card__title">REALTOR</h3>
        </a>
        <a href="accountant.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Accountant.png" alt="Accountant" class="service-card__image">
          </div>
          <h3 class="service-card__title">ACCOUNTANT</h3>
        </a>
        <a href="consultant.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Consultant.png" alt="Consultant" class="service-card__image">
          </div>
          <h3 class="service-card__title">CONSULTANT</h3>
        </a>
        <a href="ittech.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/IT.png?v=20260209" alt="IT Tech" class="service-card__image">
          </div>
          <h3 class="service-card__title">IT TECH</h3>
        </a>
        <a href="programmer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Programmer.png" alt="Programmer" class="service-card__image">
          </div>
          <h3 class="service-card__title">PROGRAMMER</h3>
        </a>
        <a href="engineer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Engineer.png" alt="Engineer" class="service-card__image">
          </div>
          <h3 class="service-card__title">ENGINEER</h3>
        </a>
        <a href="marketer.html" class="service-card">
          <div class="service-card__image-container">
            <img src="public/images/Marketer.png" alt="Marketer" class="service-card__image">
          </div>
          <h3 class="service-card__title">MARKETER</h3>
        </a>
      </div>
    </section> 

    <!-- Footer -->
    <footer class="footer">
      <p><a href="https://gisugo.com">GISUGO.com</a> is &copy; Copyright Designed by Real Interface Studios LLC</p>
    </footer>
    
    <!-- Firebase SDK (Compat version for easier integration) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    
    <!-- Firebase Helper Modules -->
    <script src="public/js/firebase-config.js"></script>
    <script src="public/js/firebase-auth.js"></script>
    <script src="public/js/firebase-db.js"></script>
    <script src="public/js/firebase-storage.js"></script>
    
    <script src="public/js/menu.js"></script>
    
    <!-- Video Player Script -->
    <script>
      function playVideo() {
        const overlay = document.querySelector('.video-thumbnail-overlay');
        const iframe = document.getElementById('youtube-player');
        
        // Hide the custom thumbnail overlay
        overlay.style.display = 'none';
        
        // Load YouTube video with autoplay and show iframe
        iframe.src = 'https://www.youtube.com/embed/ptHyvEeevR8?autoplay=1&loop=1&playlist=ptHyvEeevR8&rel=0&modestbranding=1';
        iframe.style.display = 'block';
      }
      
      // Update menu visibility based on login status
      let authUnsubscribe = null; // Store unsubscribe function to prevent memory leak
      let isNavigatingAway = false; // Track if user is navigating to another page
      
      // Detect when user clicks links to navigate away
      document.addEventListener('click', function(e) {
        const link = e.target.closest('a[href]');
        if (link && link.href && !link.href.startsWith('#') && !link.href.includes('index.html')) {
          isNavigatingAway = true;
          console.log('üîó Navigation detected, pausing auth checks');
        }
      }, true);
      
      document.addEventListener('DOMContentLoaded', function() {

        // ‚îÄ‚îÄ Instant menu render from cache ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Firebase stores the auth token in localStorage under this key.
        // If it exists the user was logged in last time ‚Äî render immediately
        // so the spinner is never seen by returning users.
        const CACHE_KEY = 'gisugo_menu_auth';
        const cachedAuth = localStorage.getItem(CACHE_KEY);
        if (cachedAuth !== null) {
          updateHomeMenu(cachedAuth === 'true');
          console.log('‚ö° Menu rendered from cache:', cachedAuth === 'true' ? 'logged in' : 'logged out');
        }
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        if (typeof firebase !== 'undefined' && firebase.auth) {
          authUnsubscribe = firebase.auth().onAuthStateChanged(async function(user) {
            console.log('üîê Firebase auth state confirmed:', user ? 'Logged in' : 'Logged out');
            // Persist state for next load so cache is always fresh
            localStorage.setItem(CACHE_KEY, user ? 'true' : 'false');
            
            if (user) {
              // Check if user has completed profile - if not, redirect to signup
              // BUT: Don't redirect if user is navigating away to another page
              if (typeof checkUserHasProfile === 'function' && !isNavigatingAway) {
                try {
                  const { hasProfile, error } = await checkUserHasProfile(user.uid);
                  // Only redirect if we definitively know there's no profile
                  // If there's an error (e.g., Firestore not ready), DON'T redirect
                  if (!hasProfile && !error && !isNavigatingAway) {
                    console.log('‚ö†Ô∏è Zombie user detected - redirecting to complete profile');
                    window.location.href = 'sign-up.html';
                    return;
                  } else if (error) {
                    console.warn('‚ö†Ô∏è Could not verify profile status - staying on page:', error);
                  }
                } catch (profileCheckError) {
                  console.warn('‚ö†Ô∏è Profile check threw error - staying on page:', profileCheckError);
                }
              }
            }
            
            // Now update menu with confirmed auth state
            updateHomeMenu(!!user);
          });
        } else {
          // Firebase not available - show logged out state
          console.warn('‚ö†Ô∏è Firebase not available');
          updateHomeMenu();
        }
      });
      
      // Cleanup: Unsubscribe from auth listener when page unloads
      window.addEventListener('beforeunload', function() {
        if (authUnsubscribe) {
          authUnsubscribe();
        }
      });
      
      function updateHomeMenu(forcedState) {
        const menuList = document.getElementById('homeMenuList');
        
        if (!menuList) return;
        
        // Use forcedState from cache if provided, otherwise check Firebase directly
        const userLoggedIn = (forcedState !== undefined)
          ? forcedState
          : ((typeof firebase !== 'undefined' && firebase.auth)
              ? firebase.auth().currentUser !== null
              : false);
        
        console.log('üìã Updating home menu - User logged in:', userLoggedIn);
        
        // Helper to build a nav card
        function navCard(emoji, label, href, color) {
          return `<a class="home-menu-card" href="${href}" data-color="${color}">
            <span class="home-menu-card-icon">${emoji}</span>
            <span class="home-menu-card-label">${label}</span>
          </a>`;
        }

        let gridHTML = '';
        let logoutHTML = '';

        if (userLoggedIn) {
          gridHTML = `
            <div class="home-menu-section-label">Menu</div>
            ${navCard('‚úèÔ∏è', 'New Post',     'new-post2.html', 'amber')}
            ${navCard('üòä', 'Account',      'profile.html',   'purple')}
            ${navCard('üí¨', 'Messages',     'messages.html',  'cyan')}
            ${navCard('üíº', 'Gigs Manager', 'jobs.html',      'green')}
            ${navCard('üõ¨', 'Landing',      'landing.html',   'pink')}
            ${navCard('üöÄ', 'Updates',      'updates.html',   'orange')}
            ${navCard('üé≠', 'Community',    'forum.html',     'teal')}
            ${navCard('üì¨', 'Contact',      'contacts.html',  'blue')}
          `;
          logoutHTML = `
            <div class="home-menu-logout-row">
              <button class="home-menu-logout-btn" onclick="handleLogout()">
                <span class="logout-icon">üö™</span> Log Out
              </button>
            </div>
          `;
        } else {
          gridHTML = `
            <div class="home-menu-section-label">Menu</div>
            ${navCard('üåê', 'Community',   'forum.html',    'teal')}
            ${navCard('üì¨', 'Contact',     'contacts.html', 'orange')}
            <a class="home-menu-card home-menu-card--full" href="login.html" data-color="green">
              <span class="home-menu-card-icon">üîê</span>
              <span class="home-menu-card-label">Login / Sign Up</span>
            </a>
          `;
        }

        // Update menu
        menuList.innerHTML = gridHTML;
        
        // Attach logout row after the grid (outside grid div)
        const existingLogout = menuList.parentElement.querySelector('.home-menu-logout-row');
        if (existingLogout) existingLogout.remove();
        if (logoutHTML) menuList.insertAdjacentHTML('afterend', logoutHTML);
      }
      
      function handleLogout() {
        console.log('üö™ Logout requested - showing confirmation...');
        
        // Show confirmation modal
        const confirmOverlay = document.getElementById('logoutConfirmOverlay');
        if (confirmOverlay) {
          confirmOverlay.classList.add('active');
        }
      }
      
      function cancelLogout() {
        console.log('‚ùå Logout cancelled');
        
        // Hide confirmation modal
        const confirmOverlay = document.getElementById('logoutConfirmOverlay');
        if (confirmOverlay) {
          confirmOverlay.classList.remove('active');
        }
      }
      
      let logoutTimeoutId = null; // Store timeout ID for cleanup
      
      async function confirmLogout() {
        console.log('‚úÖ Logout confirmed');
        
        // Hide confirmation modal
        const confirmOverlay = document.getElementById('logoutConfirmOverlay');
        if (confirmOverlay) {
          confirmOverlay.classList.remove('active');
        }
        
        // Show friendly loading overlay
        const loadingOverlay = document.getElementById('logoutOverlay');
        if (loadingOverlay) {
          loadingOverlay.classList.add('active');
        }
        
        // Add minimum display time so user sees the friendly animation (even if logout is instant)
        const minimumDisplayTime = 2500; // 2.5 seconds
        const startTime = Date.now();
        
        // Perform logout
        let logoutPromise;
        if (typeof logout === 'function') {
          logoutPromise = logout();
        } else {
          // Fallback if logout function not available
          localStorage.removeItem('gisugo_current_user');
          logoutPromise = Promise.resolve();
        }
        
        // Wait for both logout AND minimum display time
        await Promise.all([
          logoutPromise,
          new Promise(resolve => {
            const elapsed = Date.now() - startTime;
            const remaining = Math.max(0, minimumDisplayTime - elapsed);
            logoutTimeoutId = setTimeout(resolve, remaining);
          })
        ]);
        
        // Redirect to home (reload to clear state)
        window.location.href = 'index.html';
      }
      
      // Cleanup: Clear logout timeout if page unloads during logout
      window.addEventListener('beforeunload', function() {
        if (logoutTimeoutId) {
          clearTimeout(logoutTimeoutId);
        }
      });
    </script>

    
  </body>
</html>  
